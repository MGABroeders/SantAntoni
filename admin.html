<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beheerder Dashboard - Familie Sant Antoni</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="header-top">
      <button class="menu-toggle" id="menuToggle" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <h1><a href="index.html">Appartementen Sant Antoni</a></h1>
      <div class="header-right">
        <span id="firebaseStatus" style="margin-right: 1em; font-size: 0.85em; padding: 0.3em 0.6em; border-radius: 4px; background: #f5f5f5; color: #666;" title="Firebase verbindingsstatus"></span>
        <a href="#" onclick="logout(); return false;" class="header-link">Uitloggen</a>
        <span id="authNav"></span>
      </div>
    </div>
    <nav id="mainNav" class="main-nav">
      <a href="index.html">Home</a>
      <a href="admin.html">Beheer</a>
      <a href="kalender.html">Reserveren</a>
      <!-- <a href="fotos.html" id="navPhotos" class="feature-toggle">Foto's</a> -->
      <!-- <a href="berichten.html" id="navMessages" class="feature-toggle">Berichten</a> -->
    </nav>
  </header>

  <section id="admin">
    <h2>Beheerder Dashboard</h2>
    
    <!-- Tabs -->
    <div class="admin-tabs">
      <button class="admin-tab active" data-tab="accounts">Accounts</button>
      <button class="admin-tab" data-tab="transactions">Reserveringen & Transacties</button>
      <button class="admin-tab" data-tab="intentions">Intenties Beheer</button>
      <button class="admin-tab" data-tab="settings">Instellingen</button>
    </div>

    <!-- Accounts Tab -->
    <div id="accountsTab" class="admin-tab-content active">
      <h3>Gebruikersbeheer</h3>
      
      <!-- Pending Approvals -->
      <div class="admin-section">
        <h4>Wachtend op goedkeuring</h4>
        <div id="pendingUsers" class="users-list"></div>
      </div>

      <!-- Approved Users - Drag & Drop -->
      <div class="admin-section">
        <h4>Familie Organisatie</h4>
        
        <div class="families-container">
          <div class="family-column" data-family="A" ondrop="dropUser(event)" ondragover="allowDrop(event)">
            <h5>Familie A (Pieters-Louasson)</h5>
            <div id="familyAUsers" class="family-users-list"></div>
          </div>
          
          <div class="family-column" data-family="B" ondrop="dropUser(event)" ondragover="allowDrop(event)">
            <h5>Familie B (Broeders)</h5>
            <div id="familyBUsers" class="family-users-list"></div>
          </div>
          
          <div class="family-column" data-family="C" ondrop="dropUser(event)" ondragover="allowDrop(event)">
            <h5>Familie C (Geen familie)</h5>
            <div id="familyCUsers" class="family-users-list"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Transactions Tab (nu met reserveringen) -->
    <div id="transactionsTab" class="admin-tab-content">
      <h3>Reserveringen & Transacties</h3>
      <div id="transactionsList" class="transactions-list"></div>
    </div>

    <!-- Intenties Beheer Tab -->
    <div id="intentionsTab" class="admin-tab-content">
      <h3>Intenties Beheer</h3>
      <div style="margin-bottom: 1.5em; padding: 1em; background: #e3f2fd; border-radius: 8px;">
        <p><strong>Informatie:</strong> Tijdens de prioriteitsperiode (januari-maart) kunnen meerdere personen intenties indienen voor voorkeursmaanden (juni-september).</p>
        <p style="margin-top: 0.5em;"><strong>Op 1 februari</strong> kun je hier de definitieve keuze maken door een intentie te bevestigen. Andere intenties voor dezelfde periode worden automatisch verwijderd.</p>
      </div>
      <div id="intentionsList" class="transactions-list"></div>
    </div>

    <!-- Settings Tab -->
    <div id="settingsTab" class="admin-tab-content">
      <h3>Systeem Instellingen</h3>
      
      <!-- Firebase Diagnostiek -->
      <div class="admin-section">
        <h4>Firebase Diagnostiek</h4>
        <p>Test de Firebase verbinding en check of alles correct werkt.</p>
        <div style="display: flex; gap: 0.5em; flex-wrap: wrap; margin-bottom: 1em;">
          <button onclick="testFirebaseConnectionWithUI()" class="btn-primary">Test Verbinding</button>
          <button onclick="checkFirebaseData()" class="btn-primary">Check Data</button>
          <button onclick="syncFromFirebase()" class="btn-secondary">Sync van Firebase</button>
          <button onclick="syncAllToFirebase()" class="btn-primary" style="background: #ff9800;">Sync ALL naar Firebase</button>
        </div>
        <div id="firebaseDiagnostics" style="margin-top: 1em; padding: 1em; background: #f5f5f5; border-radius: 8px; display: none;">
          <pre id="firebaseDiagnosticsOutput" style="white-space: pre-wrap; font-family: monospace; font-size: 0.9em;"></pre>
        </div>
        <p style="margin-top: 1em; font-size: 0.9em; color: #666;">
          üí° <strong>Tip:</strong> Als je op je mobiel hebt gereserveerd maar het niet ziet op je PC, klik op "Check Data" om te zien of de data in Firebase staat. 
          Klik daarna op "Sync van Firebase" om de data te synchroniseren.
        </p>
        <p style="margin-top: 0.5em; font-size: 0.9em; color: #ff9800;">
          ‚ö†Ô∏è <strong>Belangrijk:</strong> Als er geen data in Firebase staat, klik op "Sync ALL naar Firebase" om alle localStorage data naar Firebase te synchroniseren. 
          Dit is een eenmalige actie om bestaande data te migreren.
        </p>
        <p style="margin-top: 0.5em; font-size: 0.9em; color: #666;">
          üîó <a href="https://console.firebase.google.com/project/familie-sant-antoni/firestore/data" target="_blank">Open Firebase Console</a> om direct te zien wat er in Firebase staat.
        </p>
      </div>
      
      <!-- Prioriteits periode -->
      <div class="admin-section">
        <h4>Prioriteits Periode</h4>
        <p>Gedurende deze periode (elk jaar) mogen alleen families met prioriteit reserveren. Daarna kan iedereen boeken.</p>
        <div class="form-group">
          <label for="priorityStartMonth">Start maand:</label>
          <input type="number" id="priorityStartMonth" min="1" max="12" value="1" class="form-control">
          <span class="help-text">Januari</span>
        </div>
        <div class="form-group">
          <label for="priorityEndMonth">Eind maand:</label>
          <input type="number" id="priorityEndMonth" min="1" max="12" value="3" class="form-control">
          <span class="help-text">Maart</span>
        </div>
        <button onclick="savePriorityPeriod()" class="btn-primary">Opslaan</button>
        
        <div style="margin-top: 2em; padding: 1em; background: #e3f2fd; border-radius: 8px; border: 2px solid #2196f3;">
          <h5 style="margin-top: 0;">üìÖ Datum Override (Test Modus)</h5>
          <p style="margin: 0.5em 0;">Stel een aangepaste datum in voor testen. Dit overschrijft de huidige datum voor alle prioriteits checks.</p>
          <div class="form-group" style="margin-top: 1em;">
            <label for="dateOverride">Aangepaste datum:</label>
            <input type="date" id="dateOverride" class="form-control">
            <span class="help-text">Laat leeg om de echte datum te gebruiken</span>
          </div>
          <div style="margin-top: 1em;">
            <button onclick="setDateOverride()" class="btn-primary" style="margin-right: 0.5em;">
              Datum Instellen
            </button>
            <button onclick="clearDateOverride()" class="btn-secondary">
              Datum Resetten
            </button>
          </div>
          <div id="dateOverrideStatus" style="margin-top: 1em; font-weight: bold;"></div>
        </div>
      </div>
      
      <!-- Zomer maanden verdeling -->
      <div class="admin-section">
        <h4>Zomer maanden verdeling per jaar</h4>
        <div id="summerDistribution"></div>
        <button onclick="loadSummerDistribution()" class="btn-secondary">Genereer Overzicht</button>
      </div>
      
      <!-- Prijzen configuratie -->
      <div class="admin-section">
        <h4>Prijzen Configuratie</h4>
        <p>Per nacht prijzen (zomer = juli + augustus, laag = rest)</p>
        
        <h5>Appartement 35</h5>
        <p>Familie = A of B. Geen familie = C</p>
        <div class="form-group">
          <label>Familie (A of B), hoogseizoen (juli/augustus):</label>
          <input type="number" id="price35_family_summer" value="58" class="form-control">
          <span class="help-text">‚Ç¨ per nacht (‚Ç¨406 per week)</span>
        </div>
        <div class="form-group">
          <label>Familie (A of B), laagseizoen:</label>
          <input type="number" id="price35_family_low" value="43" class="form-control">
          <span class="help-text">‚Ç¨ per nacht (‚Ç¨301 per week)</span>
        </div>
        <div class="form-group">
          <label>Geen familie (Familie C), hoogseizoen:</label>
          <input type="number" id="price35_noFamily_summer" value="143" class="form-control">
          <span class="help-text">‚Ç¨ per nacht (‚Ç¨1001 per week)</span>
        </div>
        <div class="form-group">
          <label>Geen familie (Familie C), laagseizoen:</label>
          <input type="number" id="price35_noFamily_low" value="86" class="form-control">
          <span class="help-text">‚Ç¨ per nacht (‚Ç¨602 per week)</span>
        </div>
        
        <h5>Appartement 36</h5>
        <p>Familie = B. Geen familie = A of C</p>
        <div class="form-group">
          <label>Familie B, hoogseizoen:</label>
          <input type="number" id="price36_familyB_summer" value="48" class="form-control">
          <span class="help-text">‚Ç¨ per nacht (‚Ç¨336 per week)</span>
        </div>
        <div class="form-group">
          <label>Familie B, laagseizoen:</label>
          <input type="number" id="price36_familyB_low" value="34" class="form-control">
          <span class="help-text">‚Ç¨ per nacht (‚Ç¨238 per week)</span>
        </div>
        <div class="form-group">
          <label>Geen familie B (A of C), hoogseizoen:</label>
          <input type="number" id="price36_noFamilyB_summer" value="675" class="form-control">
          <span class="help-text">‚Ç¨ per week (alleen hele weken)</span>
        </div>
        <div class="form-group">
          <label>Geen familie B (A of C), laagseizoen:</label>
          <input type="number" id="price36_noFamilyB_low" value="67" class="form-control">
          <span class="help-text">‚Ç¨ per nacht (‚Ç¨469 per week)</span>
        </div>
        
        <button onclick="savePricingConfig()" class="btn-primary">Opslaan Prijzen</button>
      </div>
      
      <!-- Feature Toggles - UITGESCHAKELD -->
      <!--
      <div class="admin-section">
        <h4>Functie Instellingen</h4>
        <p>Schakel functies in of uit die zichtbaar zijn op de website.</p>
        
        <div style="margin-top: 1.5em;">
          <div style="margin-bottom: 1.5em; padding: 1em; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
            <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
              <span>
                <strong>Foto's Functie</strong>
                <div style="font-size: 0.9em; color: #666; margin-top: 0.3em;">
                  Toon foto galerij en upload functionaliteit
                </div>
              </span>
              <button onclick="toggleFeature('photos')" id="photosToggleBtn" class="btn-secondary">
                Feature Inschakelen
              </button>
            </label>
            <div id="photosStatus" style="margin-top: 0.5em; font-weight: bold;"></div>
          </div>
          
          <div style="padding: 1em; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
            <label style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
              <span>
                <strong>Berichten Functie</strong>
                <div style="font-size: 0.9em; color: #666; margin-top: 0.3em;">
                  Toon berichten sectie en berichten plaatsen functionaliteit
                </div>
              </span>
              <button onclick="toggleFeature('messages')" id="messagesToggleBtn" class="btn-secondary">
                Feature Inschakelen
              </button>
            </label>
            <div id="messagesStatus" style="margin-top: 0.5em; font-weight: bold;"></div>
          </div>
        </div>
      </div>
      -->
    </div>
  </section>

  <!-- User Settings Modal -->
  <div id="userSettingsModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="modal-close" onclick="closeUserSettingsModal()">&times;</span>
      <h3>Instellingen voor <span id="settingsUserName"></span></h3>
      <form id="userSettingsForm">
        <input type="hidden" id="settingsUserId">
        
        <div class="form-group">
          <label for="settingsFamily">Familie:</label>
          <select id="settingsFamily">
            <option value="">Geen familie</option>
            <option value="A">Familie A</option>
            <option value="B">Familie B</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="settingsRank">Rang binnen familie:</label>
          <select id="settingsRank">
            <option value="">Geen rang</option>
            <option value="eigenaar">Eigenaar</option>
            <option value="niet-eigenaar">Niet-Eigenaar</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="settingsCanBook"> Mag reserveringen maken
          </label>
        </div>
        
        <div class="form-group">
          <label for="settingsMaxReservations">Max reserveringen per jaar:</label>
          <input type="number" id="settingsMaxReservations" min="1" max="20" value="5">
        </div>
        
        <div class="form-group">
          <label for="settingsPriority">Prioriteit:</label>
          <select id="settingsPriority">
            <option value="low">Laag</option>
            <option value="normal">Normaal</option>
            <option value="high">Hoog</option>
          </select>
        </div>
        
        <button type="submit" class="btn-primary">Opslaan</button>
      </form>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 Familie Sant Antoni</p>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  
  <!-- Firebase Config & Data Layer -->
  <script src="firebase-config.js"></script>
  <script src="firebase-db.js"></script>
  <script src="firebase-diagnostics.js"></script>
  
  <script src="auth.js"></script>
  <script src="auth-ui.js"></script>
  <script src="script.js"></script>
  <script src="admin.js"></script>
  
  <!-- Initialize Firebase and set up real-time listeners -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (typeof initFirebase === 'function') {
        initFirebase();
        
        // Real-time listeners voor directe updates
        setTimeout(() => {
          // Real-time listener voor reserveringen - update admin lijst automatisch
          if (typeof subscribeToReservations === 'function') {
            subscribeToReservations((reservations) => {
              console.log('Admin: Reserveringen update ontvangen:', reservations.length);
              
              // IMPORTANT: Update localStorage from Firebase (this is the source of truth)
              localStorage.setItem('santantoni_reservations', JSON.stringify(reservations));
              
              // Reload admin reservations list if transactions tab is active
              const transactionsTab = document.querySelector('.admin-tab[data-tab="transactions"]');
              if (transactionsTab && transactionsTab.classList.contains('active')) {
                if (typeof loadTransactions === 'function') {
                  loadTransactions();
                }
              }
              
              // Also update calendar if it exists (for homepage)
              if (typeof generateCalendar === 'function') {
                generateCalendar();
              }
            });
          }
        }, 1000);
      }
      
      // Check Firebase status
      updateFirebaseStatus();
      
      // Update status periodically
      setInterval(updateFirebaseStatus, 5000);
    });
    
    // Update Firebase status indicator
    function updateFirebaseStatus() {
      const statusEl = document.getElementById('firebaseStatus');
      if (!statusEl) return;
      
      // Check if Firebase is ready
      if (typeof isFirebaseReady === 'function' && isFirebaseReady()) {
        statusEl.textContent = '‚úì Firebase';
        statusEl.style.background = '#e8f5e9';
        statusEl.style.color = '#2e7d32';
        statusEl.title = 'Firebase is verbonden en werkt';
      } else {
        statusEl.textContent = '‚ö†Ô∏è Local';
        statusEl.style.background = '#fff3cd';
        statusEl.style.color = '#856404';
        statusEl.title = 'Firebase niet verbonden - gebruikt localStorage';
      }
    }
  </script>
</body>
</html>

