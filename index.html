<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Familie Sant Antoni</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="header-top">
      <button class="menu-toggle" id="menuToggle" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <h1><a href="index.html">Appartementen Sant Antoni</a></h1>
      <div class="header-right">
        <span id="firebaseStatus" style="display: none; margin-right: 1em; font-size: 0.85em; padding: 0.3em 0.6em; border-radius: 4px; background: #f5f5f5; color: #666;" title="Firebase verbindingsstatus"></span>
        <a href="contact.html" class="header-link">Contact</a>
        <span id="authNav"></span>
      </div>
    </div>
    <nav id="mainNav" class="main-nav">
      <a href="index.html">Home</a>
      <a href="kalender.html">Reserveren</a>
      <!-- <a href="fotos.html" id="navPhotos" class="feature-toggle">Foto's</a> -->
      <!-- <a href="berichten.html" id="navMessages" class="feature-toggle">Berichten</a> -->
    </nav>
  </header>

  <section id="home">
    <!-- Homepage Bericht (van admin) -->
    <div id="homepageMessage" class="homepage-message" style="display: none; margin-bottom: 2em;">
      <div class="homepage-message-content"></div>
    </div>
    
    <!-- Kalender op home pagina -->
    <div class="calendar-section" style="margin-top: 3em;">
      <h2>Beschikbaarheid</h2>
      <div class="calendar-controls">
        <button id="prevMonth" class="btn-nav">← Vorige</button>
        <h3 id="currentMonth"></h3>
        <button id="nextMonth" class="btn-nav">Volgende →</button>
      </div>
      <div class="calendars-container">
        <div class="calendar-wrapper">
          <h3 class="calendar-apartment-title">Appartement 35</h3>
          <div id="calendar-A" class="calendar-apartment" data-apartment="A"></div>
          <div class="reservation-controls">
            <input type="date" class="date-input" data-apartment="A" data-role="start" placeholder="Startdatum">
            <input type="date" class="date-input" data-apartment="A" data-role="end" placeholder="Einddatum">
            <button class="btn-reserve" data-apartment="A">Reserveren</button>
          </div>
          <!-- Reserverings Details -->
          <div id="reservationDetails-A" class="reservation-details" style="display: none; margin-top: 1.5em; padding: 1.5em; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h4 style="margin-top: 0; color: #1565c0;">Reserveringsdetails</h4>
            <div id="reservationDetailsContent-A"></div>
          </div>
        </div>
        <div class="calendar-wrapper">
          <h3 class="calendar-apartment-title">Appartement 36</h3>
          <div id="calendar-B" class="calendar-apartment" data-apartment="B"></div>
          <div class="reservation-controls">
            <input type="date" class="date-input" data-apartment="B" data-role="start" placeholder="Startdatum">
            <input type="date" class="date-input" data-apartment="B" data-role="end" placeholder="Einddatum">
            <button class="btn-reserve" data-apartment="B">Reserveren</button>
          </div>
          <!-- Reserverings Details -->
          <div id="reservationDetails-B" class="reservation-details" style="display: none; margin-top: 1.5em; padding: 1.5em; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h4 style="margin-top: 0; color: #1565c0;">Reserveringsdetails</h4>
            <div id="reservationDetailsContent-B"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Eigen Reserveringen -->
    <section id="myReservationsSection" class="reservations-section" style="margin-top: 3em; display: none;">
      <h2>Mijn Reserveringen</h2>
      <div id="myReservationsList" class="reservations-list">
        <p class="empty-state">Je hebt nog geen reserveringen</p>
      </div>
    </section>
    
  </section>

  <footer>
    <p>&copy; 2025 Familie Sant Antoni</p>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  
  <!-- Firebase Config & Data Layer -->
  <script src="firebase-config.js"></script>
  <script src="firebase-db.js"></script>
  <script src="firebase-diagnostics.js"></script>
  
  <!-- App Scripts -->
  <script src="auth.js"></script>
  <script src="auth-ui.js"></script>
  <script src="script.js"></script>
  
  <!-- Initialize Firebase -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (typeof initFirebase === 'function') {
        initFirebase();
        
        // Real-time listeners voor directe updates
        setTimeout(() => {
          // Real-time listener voor reserveringen
          if (typeof subscribeToReservations === 'function') {
            subscribeToReservations((reservations) => {
              console.log('Reserveringen update ontvangen:', reservations.length);
              // Update localStorage
              localStorage.setItem('santantoni_reservations', JSON.stringify(reservations));
              // Herlaad kalender
              if (typeof generateCalendar === 'function') {
                generateCalendar();
              }
              // Herlaad reserveringen lijst
              if (typeof displayReservations === 'function') {
                displayReservations();
              }
              // Herlaad eigen reserveringen
              if (typeof displayMyReservations === 'function') {
                displayMyReservations();
              }
            });
          }
          
        }, 2000);
      }
      
      // Update feature visibility
      updateFeatureVisibility();
      
      // Check Firebase status
      updateFirebaseStatus();
      
      // Update status periodically
      setInterval(updateFirebaseStatus, 5000);
    });
    
    // Update Firebase status indicator (alleen voor admin)
    function updateFirebaseStatus() {
      const statusEl = document.getElementById('firebaseStatus');
      if (!statusEl) return;
      
      // Check if user is admin
      const user = typeof getCurrentUser === 'function' ? getCurrentUser() : null;
      const isAdmin = user && user.role === 'admin';
      
      if (!isAdmin) {
        statusEl.style.display = 'none';
        return;
      }
      
      // Show status for admin
      statusEl.style.display = 'inline-block';
      
      // Check if Firebase is ready
      if (typeof isFirebaseReady === 'function' && isFirebaseReady()) {
        statusEl.textContent = '✓ Firebase';
        statusEl.style.background = '#e8f5e9';
        statusEl.style.color = '#2e7d32';
        statusEl.title = 'Firebase is verbonden en werkt';
      } else {
        statusEl.textContent = '⚠️ Local';
        statusEl.style.background = '#fff3cd';
        statusEl.style.color = '#856404';
        statusEl.title = 'Firebase niet verbonden - gebruikt localStorage';
      }
    }
    
    // Update feature visibility based on settings
    function updateFeatureVisibility() {
      // Check if feature functions exist (from admin.js)
      if (typeof isFeatureEnabled !== 'function') {
        // Fallback: check localStorage directly
        window.isFeatureEnabled = function(feature) {
          return localStorage.getItem(`feature_${feature}_enabled`) !== 'false'; // Default true
        };
      }
      
    }
    
    // Display homepage message
    function displayHomepageMessage(message) {
      const messageDiv = document.getElementById('homepageMessage');
      const contentDiv = document.querySelector('#homepageMessage .homepage-message-content');
      
      if (!messageDiv || !contentDiv) return;
      
      if (message && message.text && message.text.trim()) {
        // Format text with line breaks
        const formattedText = message.text.replace(/\n/g, '<br>');
        contentDiv.innerHTML = formattedText;
        messageDiv.style.display = 'block';
      } else {
        messageDiv.style.display = 'none';
      }
    }
    
  </script>
</body>
</html>
