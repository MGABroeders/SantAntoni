<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Familie Sant Antoni</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="header-top">
      <button class="menu-toggle" id="menuToggle" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <h1><a href="index.html">Appartementen Sant Antoni</a></h1>
      <div class="header-right">
        <a href="contact.html" class="header-link">Contact</a>
        <span id="authNav"></span>
      </div>
    </div>
    <nav id="mainNav" class="main-nav">
      <a href="index.html">Home</a>
      <a href="kalender.html">Reserveren</a>
      <a href="fotos.html" id="navPhotos" class="feature-toggle">Foto's</a>
      <a href="berichten.html" id="navMessages" class="feature-toggle">Berichten</a>
    </nav>
  </header>

  <section id="home">
    <div class="welcome-section">
      <h2>Welkom bij Appartementen Sant Antoni</h2>
      <p class="intro-text">
        Deze website is ons centrale punt voor het beheren en boeken van onze twee familieappartementen 
        in Sant Antoni. Hier kun je de beschikbaarheid bekijken, reserveringen maken, foto's bekijken 
        en familieberichten delen.
      </p>
    </div>
    
    <!-- Kalender op home pagina -->
    <div class="calendar-section" style="margin-top: 3em;">
      <h2>Beschikbaarheid</h2>
      <div class="calendar-controls">
        <button id="prevMonth" class="btn-nav">← Vorige</button>
        <h3 id="currentMonth"></h3>
        <button id="nextMonth" class="btn-nav">Volgende →</button>
      </div>
      <div class="calendars-container">
        <div class="calendar-wrapper">
          <h3 class="calendar-apartment-title">Appartement 35</h3>
          <div id="calendar-A" class="calendar-apartment" data-apartment="A"></div>
          <div class="reservation-controls">
            <input type="date" class="date-input" data-apartment="A" data-role="start" placeholder="Startdatum">
            <input type="date" class="date-input" data-apartment="A" data-role="end" placeholder="Einddatum">
            <button class="btn-reserve" data-apartment="A">Reserveren</button>
          </div>
        </div>
        <div class="calendar-wrapper">
          <h3 class="calendar-apartment-title">Appartement 36</h3>
          <div id="calendar-B" class="calendar-apartment" data-apartment="B"></div>
          <div class="reservation-controls">
            <input type="date" class="date-input" data-apartment="B" data-role="start" placeholder="Startdatum">
            <input type="date" class="date-input" data-apartment="B" data-role="end" placeholder="Einddatum">
            <button class="btn-reserve" data-apartment="B">Reserveren</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Eigen Reserveringen -->
    <section id="myReservationsSection" class="reservations-section" style="margin-top: 3em; display: none;">
      <h2>Mijn Reserveringen</h2>
      <div id="myReservationsList" class="reservations-list">
        <p class="empty-state">Je hebt nog geen reserveringen</p>
      </div>
    </section>
    
    <!-- Foto Galerij op home pagina -->
    <section id="fotos" class="feature-toggle" style="margin-top: 3em;">
      <h2>Foto Galerij</h2>
      <div class="photo-gallery">
        <div class="gallery-tabs">
          <button class="gallery-tab active" data-gallery="all">Alle foto's</button>
          <button class="gallery-tab" data-gallery="A">Appartement 35</button>
          <button class="gallery-tab" data-gallery="B">Appartement 36</button>
          <button class="gallery-tab" data-gallery="omgeving">Omgeving</button>
        </div>
        <div class="gallery-grid" id="galleryGrid">
          <!-- Foto's worden hier dynamisch geladen -->
        </div>
      </div>
      
      <!-- Lightbox voor uitvergrootte foto's -->
      <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <span class="lightbox-close">&times;</span>
        <img id="lightbox-img" class="lightbox-image" src="" alt="">
      </div>
    </section>
    
    <!-- Familieberichten op home pagina -->
    <section id="berichten" class="feature-toggle" style="margin-top: 3em;">
      <h2>Familieberichten</h2>
      <div class="messages-section">
        <div class="messages-list" id="messagesList">
          <!-- Berichten worden hier dynamisch geladen -->
        </div>
        <div class="new-message-form">
          <h3>Nieuw bericht plaatsen</h3>
          <div id="messageLoginPrompt" style="display: none; padding: 1.5em; text-align: center; background: #fff3cd; border-radius: 8px; margin-bottom: 1em;">
            <p>Je moet ingelogd zijn om berichten te plaatsen.</p>
            <a href="login.html" class="btn-primary">Inloggen</a>
          </div>
          <form id="messageForm" style="display: none;">
            <div id="messageUserInfo" class="form-group" style="display: none;">
              <label>Bericht van:</label>
              <div id="messageCurrentUserInfo" style="padding: 0.5em; background: #e3f2fd; border-radius: 4px;"></div>
            </div>
            <div class="form-group">
              <label for="messageText">Bericht:</label>
              <textarea id="messageText" rows="4" required placeholder="Deel een update, ervaring of nieuws..."></textarea>
            </div>
            <button type="submit" class="btn-primary">Bericht plaatsen</button>
          </form>
        </div>
      </div>
    </section>
  </section>

  <footer>
    <p>&copy; 2025 Familie Sant Antoni</p>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  
  <!-- Firebase Config & Data Layer -->
  <script src="firebase-config.js"></script>
  <script src="firebase-db.js"></script>
  <script src="firebase-storage.js"></script>
  <script src="firebase-diagnostics.js"></script>
  
  <!-- App Scripts -->
  <script src="auth.js"></script>
  <script src="auth-ui.js"></script>
  <script src="script.js"></script>
  
  <!-- Initialize Firebase -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (typeof initFirebase === 'function') {
        initFirebase();
        
        // Real-time listeners voor directe updates
        setTimeout(() => {
          // Real-time listener voor reserveringen
          if (typeof subscribeToReservations === 'function') {
            subscribeToReservations((reservations) => {
              console.log('Reserveringen update ontvangen:', reservations.length);
              // Update localStorage
              localStorage.setItem('santantoni_reservations', JSON.stringify(reservations));
              // Herlaad kalender
              if (typeof generateCalendar === 'function') {
                generateCalendar();
              }
              // Herlaad reserveringen lijst
              if (typeof displayReservations === 'function') {
                displayReservations();
              }
              // Herlaad eigen reserveringen
              if (typeof displayMyReservations === 'function') {
                displayMyReservations();
              }
            });
          }
          
          // Real-time listener voor berichten
          if (typeof subscribeToMessages === 'function') {
            subscribeToMessages((messages) => {
              console.log('Berichten update ontvangen:', messages.length);
              // Update localStorage
              localStorage.setItem('santantoni_messages', JSON.stringify(messages));
              // Herlaad berichten
              if (typeof displayMessages === 'function') {
                displayMessages();
              }
            });
          }
          
          // Load photos from Firebase
          if (typeof getPhotos === 'function') {
            getPhotos().then(photos => {
              displayHomePhotos(photos);
            });
          }
          
          // Subscribe to photos
          if (typeof subscribeToPhotos === 'function') {
            subscribeToPhotos((photos) => {
              console.log('Foto\'s update ontvangen:', photos.length);
              displayHomePhotos(photos);
            });
          }
        }, 2000);
      }
      
      // Update feature visibility
      updateFeatureVisibility();
    });
    
    // Update feature visibility based on settings
    function updateFeatureVisibility() {
      // Check if feature functions exist (from admin.js)
      if (typeof isFeatureEnabled !== 'function') {
        // Fallback: check localStorage directly
        window.isFeatureEnabled = function(feature) {
          return localStorage.getItem(`feature_${feature}_enabled`) !== 'false'; // Default true
        };
      }
      
      // Photos feature
      const photosEnabled = isFeatureEnabled('photos');
      const navPhotos = document.getElementById('navPhotos');
      const sectionPhotos = document.getElementById('fotos');
      
      if (navPhotos) {
        navPhotos.style.display = photosEnabled ? '' : 'none';
      }
      if (sectionPhotos) {
        sectionPhotos.style.display = photosEnabled ? '' : 'none';
      }
      
      // Messages feature
      const messagesEnabled = isFeatureEnabled('messages');
      const navMessages = document.getElementById('navMessages');
      const sectionMessages = document.getElementById('berichten');
      
      if (navMessages) {
        navMessages.style.display = messagesEnabled ? '' : 'none';
      }
      if (sectionMessages) {
        sectionMessages.style.display = messagesEnabled ? '' : 'none';
      }
    }
    
    // Display photos on homepage
    function displayHomePhotos(photos) {
      const grid = document.getElementById('galleryGrid');
      if (!grid) return;
      
      if (photos.length === 0) {
        grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2em; color: #999;">Nog geen foto\'s geüpload</div>';
        return;
      }
      
      const user = typeof getCurrentUser === 'function' ? getCurrentUser() : null;
      const isAdmin = typeof isAdminUser === 'function' ? isAdminUser() : false;
      
      grid.innerHTML = photos.map(photo => {
        const canDelete = isAdmin || (user && (photo.uploadedById === user.id || photo.uploadedByEmail === user.email));
        const deleteButton = canDelete 
          ? `<button class="btn-delete" onclick="handleDeletePhoto('${photo.id}', '${photo.url}')">×</button>`
          : '';
        
        return `
          <div class="gallery-item" data-category="${photo.category || 'all'}">
            ${deleteButton}
            <img src="${photo.url}" alt="${photo.description || 'Foto'}" onclick="openLightbox('${photo.url}', '${photo.description || ''}')">
          </div>
        `;
      }).join('');
      
      // Re-init gallery tabs
      if (typeof initGallery === 'function') {
        initGallery();
      }
    }
    
    // Handle photo deletion (homepage)
    async function handleDeletePhoto(photoId, photoUrl) {
      if (confirm('Weet je zeker dat je deze foto wilt verwijderen?')) {
        if (typeof deletePhoto === 'function') {
          const success = await deletePhoto(photoId, photoUrl);
          if (success) {
            // Photos will auto-update via real-time listener
          }
        } else {
          alert('Verwijder functie niet beschikbaar');
        }
      }
    }
  </script>
</body>
</html>
